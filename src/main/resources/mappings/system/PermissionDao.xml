<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fzy.core.dao.system.PermissionDao">

    <sql id="permissionColumn">
		a.id,
		a.parent_id AS 'parent.id',
		a.type,
		a.url,
		a.permission,
		a.name,
		a.sort,
		remarks
	</sql>

    <select id="findList" resultType="Permission">
        SELECT
        <include refid="permissionColumn"/>
        FROM sys_permission a
    </select>

	<select id="get" resultType="Permission">
		SELECT
		<include refid="permissionColumn"/>
		FROM sys_permission a
		WHERE id = #{id}
	</select>

    <select id="findPermissionByUser" resultType="Permission">
        SELECT
        <include refid="permissionColumn"/>
        FROM sys_permission a
        WHERE a.id IN (
			SELECT permission_id
			FROM sys_role_permission
			WHERE role_id IN (
				SELECT role_id
				FROM sys_user_role
				WHERE user_id = #{userId}
			)
        )
    </select>

    <insert id="insert">
		INSERT INTO sys_permission(
			id,
			parent_id,
			type,
			url,
			name,
			permission,
			sort,
			remarks
		) VALUES (
			#{id}, 
			#{parent.id},
			#{type},
			#{url},
			#{name},
			#{permission},
			#{sort},
			#{remarks}
		)
	</insert>

	<update id="update">
		UPDATE sys_permission
		<set>
			<if test="type != null ">
				type = #{type},
			</if>
			<if test="name != null ">
				name = #{name},
			</if>
			<if test="permission !=null ">
				permission = #{permission},
			</if>
			<if test="sort != null ">
				sort = #{sort},
			</if>
			<if test="remarks !=null ">
				remarks = #{remarks},
			</if>
		</set>
		WHERE id = #{id}
	</update>

	<delete id="batchDelete">
		DELETE FROM sys_permission
		WHERE id IN
		<foreach collection="list" index="index" item="item" open="(" close=")" separator=",">
			#{item}
		</foreach>
	</delete>


</mapper>